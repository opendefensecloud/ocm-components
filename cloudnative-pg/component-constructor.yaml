components:
  - name: opendefense.cloud/cnpg
    provider:
      name: cloudnative-pg.io
    labels:
      - name: app.kubernetes.io/name
        value: cloudnative-pg
      - name: app.kubernetes.io/component
        value: database-operator
      - name: app.kubernetes.io/part-of
        value: cloudnative-pg
    resources:
      # ResourceGraphDefinition for KRO bootstrapping
      - name: cloudnative-pg-rgd
        type: yaml
        relation: local
        input:
          type: file
          path: rgd-template.yaml

      # CloudNativePG Operator Helm Chart (official)
      - name: cnpg-operator-chart
        type: helmChart
        version: 0.27.0
        relation: external
        access:
          type: helm
          helmChart: cloudnative-pg:0.27.1
          helmRepository: https://cloudnative-pg.github.io/charts

      # CloudNativePG Cluster Helm Chart (official)
      - name: cnpg-cluster-chart
        type: helmChart
        version: 0.5.0
        relation: external
        access:
          type: helm
          helmChart: cluster:0.5.0
          helmRepository: https://cloudnative-pg.github.io/charts

      # CloudNativePG Operator Container Image
      - name: cnpg-operator-image
        type: ociImage
        version: 1.27.1
        relation: external
        access:
          type: ociArtifact
          imageReference: ghcr.io/cloudnative-pg/cloudnative-pg:1.28.1

      # PostgreSQL 17 Image (latest supported)
      - name: postgresql-17-image
        type: ociImage
        version: "17"
        relation: external
        access:
          type: ociArtifact
          imageReference: ghcr.io/cloudnative-pg/postgresql:17

      # PostgreSQL 16 Image (LTS)
      - name: postgresql-16-image
        type: ociImage
        version: "16"
        relation: external
        access:
          type: ociArtifact
          imageReference: ghcr.io/cloudnative-pg/postgresql:16

      # Minimal Configuration (Single instance, development)
      - name: cnpg-minimal-config
        type: yaml
        relation: local
        input:
          type: file
          path: cluster-minimal.yaml

      # Production Configuration (HA with replicas, backup, monitoring)
      - name: cnpg-production-config
        type: yaml
        relation: local
        input:
          type: file
          path: cluster-production.yaml

    # TODO: see also comment in ../artifact-conduit/component-constructor.yaml
    # sources:
    #   - name: cnpg-operator-source
    #     type: git
    #     version: 1.27.1
    #     access:
    #       type: github
    #       repoUrl: github.com/cloudnative-pg/cloudnative-pg
    #       ref: release-1.27

    #   - name: cnpg-helm-charts-source
    #     type: git
    #     version: 1.27.1
    #     access:
    #       type: github
    #       repoUrl: github.com/cloudnative-pg/charts
    #       ref: main
